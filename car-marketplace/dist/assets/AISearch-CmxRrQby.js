import{r as _,_ as W,q as Y,c as O,o as z,a as m,b as v,e,f as $,t as r,w as g,v as L,s as J,F as C,g as b,n as K,l as T,i as y,h as E}from"./index-CsfPRsMY.js";const X=()=>{const f=_([]),j=_([]),V=_(!1),h=_({totalSearches:0,avgResponseTime:0,popularTerms:[]}),H=async(a,u="relevance")=>{V.value=!0;try{const c=Date.now(),o=await M(a,u),i=Date.now()-c;return j.value=o.results,w(a,o.results.length,i),B(a,o.results.length),o.results}catch(c){throw console.error("Search failed:",c),c}finally{V.value=!1}},M=(a,u)=>new Promise(c=>{setTimeout(()=>{let o=F();a.query&&(o=o.filter(i=>i.make.toLowerCase().includes(a.query.toLowerCase())||i.model.toLowerCase().includes(a.query.toLowerCase())||i.description.toLowerCase().includes(a.query.toLowerCase()))),a.priceMin&&(o=o.filter(i=>i.price>=a.priceMin)),a.priceMax&&(o=o.filter(i=>i.price<=a.priceMax)),a.yearMin&&(o=o.filter(i=>i.year>=a.yearMin)),a.yearMax&&(o=o.filter(i=>i.year<=a.yearMax)),a.make&&a.make!=="all"&&(o=o.filter(i=>i.make===a.make)),a.fuelType&&a.fuelType!=="all"&&(o=o.filter(i=>i.fuelType===a.fuelType)),a.transmission&&a.transmission!=="all"&&(o=o.filter(i=>i.transmission===a.transmission)),u==="relevance"?o=q(o,a):u==="smart"?o=P(o,a):u==="price_asc"?o=o.sort((i,d)=>i.price-d.price):u==="price_desc"?o=o.sort((i,d)=>d.price-i.price):u==="year_desc"?o=o.sort((i,d)=>d.year-i.year):u==="year_asc"&&(o=o.sort((i,d)=>i.year-d.year)),c({results:o,total:o.length})},Math.random()*800+500)}),q=(a,u)=>a.sort((c,o)=>{const i=I(c,u);return I(o,u)-i}),P=(a,u)=>a.sort((c,o)=>{const i=n(c,u);return n(o,u)-i}),I=(a,u)=>{let c=0;if(u.query){const o=u.query.toLowerCase(),i=a.make.toLowerCase().includes(o),d=a.model.toLowerCase().includes(o),p=a.description.toLowerCase().includes(o);i&&(c+=100),d&&(c+=80),p&&(c+=20)}return c+=a.views*.1,c+=a.likes*.5,c},n=(a,u)=>{let c=0;c+=a.views*.1,c+=a.likes*.3,c+=a.contactCount*2;const o=2025-a.year;c+=Math.max(0,15-o)*5;const i=D(a.make,a.model),d=a.price/i;if(d<.9&&(c+=30),d<.8&&(c+=50),c+=a.images.length*2,c+=a.description.length>100?10:0,a.location&&u.userLocation){const A=S(a.location,u.userLocation);c+=Math.max(0,100-A)}const p=(Date.now()-a.postedDate)/(1e3*60*60*24);return c+=Math.max(0,30-p),c},D=(a,u)=>({BMW:45e3,Mercedes:5e4,Audi:42e3,Toyota:25e3,Honda:22e3,Volkswagen:28e3,Ford:2e4,Hyundai:18e3})[a]||3e4,S=(a,u)=>Math.random()*200,w=(a,u,c)=>{if(h.value.totalSearches++,h.value.avgResponseTime=(h.value.avgResponseTime+c)/2,a.query){const o=a.query.toLowerCase(),i=h.value.popularTerms.find(d=>d.term===o);i?i.count++:h.value.popularTerms.push({term:o,count:1}),h.value.popularTerms.sort((d,p)=>p.count-d.count),h.value.popularTerms=h.value.popularTerms.slice(0,10)}},B=(a,u)=>{const c={id:Date.now(),filters:{...a},resultCount:u,timestamp:new Date,query:a.query||"بحث متقدم"};f.value.unshift(c),f.value.length>50&&(f.value=f.value.slice(0,50)),localStorage.setItem("searchHistory",JSON.stringify(f.value))},U=()=>{try{const a=localStorage.getItem("searchHistory");a&&(f.value=JSON.parse(a))}catch(a){console.error("Failed to load search history:",a)}},k=()=>{f.value=[],localStorage.removeItem("searchHistory")},R=a=>{const u=[],c=F();if(a.length<2)return u;const o=a.toLowerCase();return[...new Set(c.map(p=>p.make))].forEach(p=>{p.toLowerCase().includes(o)&&u.push({type:"make",value:p,label:`جميع سيارات ${p}`})}),c.forEach(p=>{p.model.toLowerCase().includes(o)&&u.push({type:"model",value:`${p.make} ${p.model}`,label:`${p.make} ${p.model}`})}),u.filter((p,A,s)=>A===s.findIndex(t=>t.value===p.value)).slice(0,8)},F=()=>[{id:1,make:"BMW",model:"X5",year:2022,price:65e3,mileage:25e3,fuelType:"بنزين",transmission:"أوتوماتيك",description:"سيارة BMW X5 فاخرة بحالة ممتازة، تم صيانتها بانتظام",images:["image1.jpg","image2.jpg","image3.jpg"],views:1250,likes:89,contactCount:23,location:{lat:42.6977,lng:23.3219},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"أحمد محمد",verified:!0},{id:2,make:"Mercedes",model:"C-Class",year:2021,price:45e3,mileage:32e3,fuelType:"ديزل",transmission:"أوتوماتيك",description:"مرسيدس C-Class أنيقة ومريحة مع جميع الخيارات",images:["image1.jpg","image2.jpg"],views:890,likes:67,contactCount:18,location:{lat:42.1354,lng:24.7453},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"فاطمة أحمد",verified:!0},{id:3,make:"Audi",model:"A4",year:2023,price:52e3,mileage:15e3,fuelType:"بنزين",transmission:"أوتوماتيك",description:"أودي A4 حديثة مع أحدث التقنيات والمميزات",images:["image1.jpg","image2.jpg","image3.jpg","image4.jpg"],views:1560,likes:124,contactCount:31,location:{lat:43.2141,lng:27.9147},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"محمد عبدالله",verified:!0},{id:4,make:"Toyota",model:"Camry",year:2020,price:28e3,mileage:45e3,fuelType:"هايبرد",transmission:"أوتوماتيك",description:"تويوتا كامري هايبرد موفرة في الوقود وموثوقة",images:["image1.jpg","image2.jpg"],views:756,likes:45,contactCount:12,location:{lat:42.5048,lng:27.4626},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"سارة محمود",verified:!1},{id:5,make:"Honda",model:"Civic",year:2019,price:22e3,mileage:55e3,fuelType:"بنزين",transmission:"يدوي",description:"هوندا سيفيك اقتصادية ومناسبة للاستخدام اليومي",images:["image1.jpg"],views:432,likes:28,contactCount:8,location:{lat:43.8564,lng:25.9717},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"خالد عبدالرحمن",verified:!0},{id:6,make:"Volkswagen",model:"Golf",year:2021,price:32e3,mileage:28e3,fuelType:"ديزل",transmission:"أوتوماتيك",description:"فولكس واجن جولف عملية مع استهلاك وقود ممتاز",images:["image1.jpg","image2.jpg","image3.jpg"],views:623,likes:38,contactCount:15,location:{lat:41.6086,lng:23.395},postedDate:Date.now()-Math.random()*30*24*60*60*1e3,seller:"ليلى حسن",verified:!0}];return U(),{searchResults:j,searchHistory:f,searchStats:h,isSearching:V,performSearch:H,clearSearchHistory:k,getSearchSuggestions:R,loadSearchHistory:U}},G={class:"ai-search-container glass-effect"},Q={class:"search-header"},Z={class:"search-form"},x={class:"search-input-container"},ee={class:"search-input-wrapper"},ae=["placeholder"],se={key:0,class:"search-suggestions"},te=["onClick"],oe={class:"search-controls"},le={value:"smart"},ie={value:"relevance"},re={value:"price_asc"},ne={value:"price_desc"},ce={value:"year_desc"},ue={value:"year_asc"},de=["disabled"],pe={key:0,class:"fas fa-search"},me={key:1,class:"fas fa-spinner fa-spin"},ve={key:0,class:"advanced-filters glass-effect"},he={class:"filters-grid"},ge={class:"filter-group"},ye={class:"price-inputs"},fe=["placeholder"],Se={class:"separator"},_e=["placeholder"],ke={class:"filter-group"},Me={class:"year-inputs"},we={value:""},$e=["value"],Ce={value:""},be=["value"],Te={class:"filter-group"},qe={value:""},De=["value"],Ae={class:"filter-group"},Le={value:""},je={class:"filter-group"},Ve={value:""},He={class:"filter-group"},Ie={class:"mileage-inputs"},Be=["placeholder"],Ue={class:"separator"},Fe=["placeholder"],Ee={class:"filters-actions"},Pe={key:1,class:"search-history"},Re={class:"history-items"},Ne=["onClick"],Oe={key:2,class:"search-stats"},We={class:"stat-item"},Ye={class:"stat-item"},ze={key:3,class:"popular-terms"},Je={class:"terms-list"},Ke=["onClick"],Xe={__name:"AISearch",emits:["search"],setup(f,{emit:j}){const{t:V}=Y(),h=j,{searchHistory:H,searchStats:M,isSearching:q,performSearch:P,getSearchSuggestions:I}=X(),n=_({query:"",sortBy:"smart",priceMin:"",priceMax:"",yearMin:"",yearMax:"",make:"",fuelType:"",transmission:"",mileageMin:"",mileageMax:""}),D=_(!1),S=_(!1),w=_([]),B=O(()=>{const s=new Date().getFullYear(),t=[];for(let l=s;l>=1990;l--)t.push(l);return t}),U=_(["BMW","Mercedes","Audi","Toyota","Honda","Volkswagen","Ford","Hyundai","Nissan","Mazda"]),k=async()=>{if(!(!n.value.query.trim()&&!R.value))try{const s=await P(n.value,n.value.sortBy);h("search",s),S.value=!1}catch(s){console.error("Search failed:",s)}},R=O(()=>Object.keys(n.value).some(s=>s!=="query"&&s!=="sortBy"&&n.value[s])),F=async()=>{n.value.query.length>=2?(w.value=await I(n.value.query),S.value=w.value.length>0):S.value=!1},a=s=>{n.value.query=s.value,S.value=!1,k()},u=s=>{const t={make:"fas fa-industry",model:"fas fa-car",default:"fas fa-search"};return t[s]||t.default},c=()=>{n.value.query="",S.value=!1},o=()=>{D.value=!D.value},i=()=>{Object.keys(n.value).forEach(s=>{s!=="sortBy"&&(n.value[s]="")}),n.value.sortBy="smart"},d=s=>{n.value={...s.filters},k()},p=s=>{n.value.query=s,k()},A=s=>{s.target.closest(".search-input-container")||(S.value=!1)};return z(()=>{document.addEventListener("click",A)}),(s,t)=>(v(),m("div",G,[e("div",Q,[e("h2",null,r(s.$t("aiSearch.title")),1),e("p",null,r(s.$t("aiSearch.subtitle")),1)]),e("div",Z,[e("div",x,[e("div",ee,[t[12]||(t[12]=e("i",{class:"fas fa-search search-icon"},null,-1)),g(e("input",{type:"text",placeholder:s.$t("aiSearch.search_placeholder"),"onUpdate:modelValue":t[0]||(t[0]=l=>n.value.query=l),onInput:F,onKeyup:J(k,["enter"]),class:"search-input"},null,40,ae),[[L,n.value.query]]),n.value.query?(v(),m("button",{key:0,onClick:c,class:"clear-btn"},[...t[11]||(t[11]=[e("i",{class:"fas fa-times"},null,-1)])])):$("",!0)]),S.value&&w.value.length>0?(v(),m("div",se,[(v(!0),m(C,null,b(w.value,l=>(v(),m("div",{key:l.value,class:"suggestion-item",onClick:N=>a(l)},[e("i",{class:K(u(l.type))},null,2),e("span",null,r(l.label),1)],8,te))),128))])):$("",!0)]),e("div",oe,[g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.value.sortBy=l),class:"sort-select"},[e("option",le,r(s.$t("aiSearch.smart_sort")),1),e("option",ie,r(s.$t("aiSearch.relevance_sort")),1),e("option",re,r(s.$t("aiSearch.price_low_to_high")),1),e("option",ne,r(s.$t("aiSearch.price_high_to_low")),1),e("option",ce,r(s.$t("aiSearch.newest_first")),1),e("option",ue,r(s.$t("aiSearch.oldest_first")),1)],512),[[T,n.value.sortBy]]),e("button",{onClick:k,class:"btn-primary search-btn",disabled:y(q)},[y(q)?(v(),m("i",me)):(v(),m("i",pe)),E(" "+r(y(q)?s.$t("aiSearch.searching"):s.$t("aiSearch.search_button")),1)],8,de),e("button",{onClick:o,class:"btn-secondary filters-btn"},[t[13]||(t[13]=e("i",{class:"fas fa-filter"},null,-1)),E(" "+r(s.$t("aiSearch.advanced_filters")),1)])])]),D.value?(v(),m("div",ve,[e("h3",null,r(s.$t("aiSearch.advanced_filters_title")),1),e("div",he,[e("div",ge,[e("label",null,r(s.$t("aiSearch.price_range")),1),e("div",ye,[g(e("input",{type:"number",placeholder:s.$t("aiSearch.price_from"),"onUpdate:modelValue":t[2]||(t[2]=l=>n.value.priceMin=l),class:"price-input"},null,8,fe),[[L,n.value.priceMin]]),e("span",Se,r(s.$t("aiSearch.price_to")),1),g(e("input",{type:"number",placeholder:s.$t("aiSearch.price_to"),"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.priceMax=l),class:"price-input"},null,8,_e),[[L,n.value.priceMax]])])]),e("div",ke,[e("label",null,r(s.$t("aiSearch.year_of_manufacture")),1),e("div",Me,[g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.yearMin=l),class:"year-select"},[e("option",we,r(s.$t("aiSearch.year_from")),1),(v(!0),m(C,null,b(B.value,l=>(v(),m("option",{key:l,value:l},r(l),9,$e))),128))],512),[[T,n.value.yearMin]]),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.yearMax=l),class:"year-select"},[e("option",Ce,r(s.$t("aiSearch.year_to")),1),(v(!0),m(C,null,b(B.value,l=>(v(),m("option",{key:l,value:l},r(l),9,be))),128))],512),[[T,n.value.yearMax]])])]),e("div",Te,[e("label",null,r(s.$t("aiSearch.brand")),1),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.make=l),class:"filter-select"},[e("option",qe,r(s.$t("aiSearch.all_brands")),1),(v(!0),m(C,null,b(U.value,l=>(v(),m("option",{key:l,value:l},r(l),9,De))),128))],512),[[T,n.value.make]])]),e("div",Ae,[e("label",null,r(s.$t("aiSearch.fuel_type")),1),g(e("select",{"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.fuelType=l),class:"filter-select"},[e("option",Le,r(s.$t("aiSearch.all_fuel_types")),1),t[14]||(t[14]=e("option",{value:"Petrol"},"Petrol",-1)),t[15]||(t[15]=e("option",{value:"Diesel"},"Diesel",-1)),t[16]||(t[16]=e("option",{value:"Hybrid"},"Hybrid",-1)),t[17]||(t[17]=e("option",{value:"Electric"},"Electric",-1))],512),[[T,n.value.fuelType]])]),e("div",je,[e("label",null,r(s.$t("aiSearch.transmission")),1),g(e("select",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.transmission=l),class:"filter-select"},[e("option",Ve,r(s.$t("aiSearch.all_transmissions")),1),t[18]||(t[18]=e("option",{value:"Automatic"},"Automatic",-1)),t[19]||(t[19]=e("option",{value:"Manual"},"Manual",-1))],512),[[T,n.value.transmission]])]),e("div",He,[e("label",null,r(s.$t("aiSearch.mileage")),1),e("div",Ie,[g(e("input",{type:"number",placeholder:s.$t("aiSearch.price_from"),"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.mileageMin=l),class:"mileage-input"},null,8,Be),[[L,n.value.mileageMin]]),e("span",Ue,r(s.$t("aiSearch.price_to")),1),g(e("input",{type:"number",placeholder:s.$t("aiSearch.price_to"),"onUpdate:modelValue":t[10]||(t[10]=l=>n.value.mileageMax=l),class:"mileage-input"},null,8,Fe),[[L,n.value.mileageMax]])])])]),e("div",Ee,[e("button",{onClick:i,class:"btn-secondary"},[t[20]||(t[20]=e("i",{class:"fas fa-eraser"},null,-1)),E(" "+r(s.$t("aiSearch.clear_filters")),1)]),e("button",{onClick:k,class:"btn-primary"},[t[21]||(t[21]=e("i",{class:"fas fa-search"},null,-1)),E(" "+r(s.$t("aiSearch.apply_filters")),1)])])])):$("",!0),y(H).length>0?(v(),m("div",Pe,[e("h4",null,r(s.$t("aiSearch.recent_searches")),1),e("div",Re,[(v(!0),m(C,null,b(y(H).slice(0,5),l=>(v(),m("div",{key:l.id,class:"history-item",onClick:N=>d(l)},[t[22]||(t[22]=e("i",{class:"fas fa-history"},null,-1)),e("span",null,r(l.query),1),e("small",null,r(l.resultCount)+" "+r(s.$t("aiSearch.result")),1)],8,Ne))),128))])])):$("",!0),y(M).totalSearches>0?(v(),m("div",Oe,[e("div",We,[t[23]||(t[23]=e("i",{class:"fas fa-search"},null,-1)),e("span",null,r(y(M).totalSearches)+" "+r(s.$t("aiSearch.search_operation")),1)]),e("div",Ye,[t[24]||(t[24]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,r(s.$t("aiSearch.avg_response_time"))+": "+r(Math.round(y(M).avgResponseTime))+"ms",1)])])):$("",!0),y(M).popularTerms.length>0?(v(),m("div",ze,[e("h4",null,r(s.$t("aiSearch.popular_terms")),1),e("div",Je,[(v(!0),m(C,null,b(y(M).popularTerms.slice(0,8),l=>(v(),m("span",{key:l.term,class:"term-tag",onClick:N=>p(l.term)},r(l.term)+" ("+r(l.count)+") ",9,Ke))),128))])])):$("",!0)]))}},Qe=W(Xe,[["__scopeId","data-v-73d65f45"]]);export{Qe as default};
